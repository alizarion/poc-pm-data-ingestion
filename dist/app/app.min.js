/*!
 * Copyright 2015 itesoft.
 * http://itesoft.com/
 *
 * webapp_seed, v2.6.1
 * A powerful music manager.*/
!function(){angular.module("share.ws.demo",["itesoft","ngRoute","ngSanitize","mgcrea.ngStrap.datepicker","mgcrea.ngStrap.timepicker","pascalprecht.translate","ui.bootstrap.dropdown"]).config(["$datepickerProvider",function(e){}]).config(["$translateProvider","$translatePartialLoaderProvider","$httpProvider",function(e,r,t){e.registerAvailableLanguageKeys(["en","fr","de"],{en_US:"en",en_GB:"en",fr_FR:"fr","fr-CA":"fr","de-DE":"de"}).determinePreferredLanguage(),e.useLoader("$translatePartialLoader",{urlTemplate:"assets/locale/{lang}/{part}-{lang}.json"}),t.interceptors.push("HttpErrorHandler"),e.useSanitizeValueStrategy()}]).run(["$rootScope","$route",function(e,r){e.$on("$routeChangeSuccess",function(){e.pageTitle=r.current.title})}]),angular.module("share.ws.demo").config(["$routeProvider",function(e){e.when("/home",{templateUrl:"app/features/home/homeView.html",controller:"HomeController",title:"HOME.TITLE"}).otherwise({redirectTo:"/home"})}]),angular.module("share.ws.demo").controller("HomeController",["$scope","FetchDataService","ShareService","CacheRequestService","$rootScope",function(e,r,t,a,n){e.myDefs=[],e.dataSource=[],e.myDefs=[],e.search=function(){t.search(n.searchRequest).then(function(r){e.dataSource=[],e.dataSource=r.data,e.myDefs=[];var t=e.dataSource[0];for(var a in t)e.myDefs.push({field:a});e.searchControl={columnDefs:e.myDefs},e.shareGridOptions.columnDefs=e.myDefs})},e.searchControl={columnDefs:e.myDefs},e.shareGridOptions={data:"dataSource",showGridFooter:!0,columnDefs:e.myDefs,onRegisterApi:function(r){e.gridApi=r,e.gridApi.grid.registerRowsProcessor(e.searchControl.multicolumnsFilter,200)}},e.saveState=function(){a.save(n.searchRequest)},e.filter=function(){e.gridApi.grid.refresh()}}]),angular.module("share.ws.demo").directive("queryGrid",["QueryField",function(e){return{scope:{searchQueryFields:"="},templateUrl:"app/features/home/queryGrid.html",controller:["$scope",function(r){r.searchQueryFields||(r.searchQueryFields.query=[]),r.query={},r.addQueryField=function(){r.searchQueryFields.query.push(new e("","=="))},r.removeQueryField=function(e){var t=r.searchQueryFields.query.indexOf(e);t>-1&&r.searchQueryFields.query.splice(t,1)}}]}}]),angular.module("share.ws.demo").controller("MainController",["$scope","$translate","$rootScope","CacheRequestService",function(e,r,t,a){t.searchRequest=a.load(),e.currentLanguage="fr_FR",e.changeLanguage=function(t){e.currentLanguage=t,r.use(t)}}]),angular.module("share.ws.demo").factory("CacheRequestService",["QueryField",function(e){function r(e){localStorage.setItem(a,angular.toJson(e))}function t(){var r=angular.fromJson(localStorage.getItem(a));return r||(r={},r.query=[],r.query.push(new e("SenderKey","==")),r.query.push(new e("SenderType","==")),r.query.push(new e("ActivityKey","==")),r.query.push(new e("ActivityStage","==")),r.query.push(new e("EntityKey","==")),r.query.push(new e("EntityType","==")),r.query.push(new e("ProcessKey","==")),r.query.push(new e("TaskStatus","==")),r.query.push(new e("TaskKey","==")),r.query.push(new e("SenderType","==")),r.query.push(new e("ProcessKey","==")),r.query.push(new e("CreationDate","=ge=")),r.query.push(new e("CreationDate","=le=")),r.query.push(new e("DueDate","=ge=")),r.query.push(new e("DueDate","=le="))),r.isComplete=function(){return r.serviceUrl},r}var a="share_ws_saved_request";return{load:t,save:r}}]),angular.module("share.ws.demo").factory("FetchDataService",function(){function e(e){console.log(e.header.columnsHeader);var r=0,t={};return angular.forEach(e.header.columnsHeader,function(e){t[e.code]=e.desc,r++}),t}function r(e){var r=[];return console.log(e),e.documents.forEach(function(t){var a={};a.docIdxGed=t.docIdxGed;var n=0;angular.forEach(t.fields,function(r){a[e.header.columnsHeader[n].code]=r.translation?r.translation:r.value,n++}),r.push(a)}),r}return{extractTraduction:e,extractValues:r}}),angular.module("share.ws.demo").factory("HttpErrorHandler",["$rootScope","$q",function(e,r){return{request:function(r){return e.$error=null,r},requestError:function(e){return r.reject(e)},response:function(e){return e},responseError:function(t){return t.data.status=t.status,e.$error=t.data,r.reject(t)}}}]),angular.module("share.ws.demo").factory("QueryField",[function(e){var r=function(e,r,t){this.key=e,this.operator=r,this.value=t};return r.prototype.getQueryParameter=function(){},r}]),angular.module("share.ws.demo").factory("ShareService",["$http","CacheRequestService","$rootScope",function(e,r,t){function a(e){var r=[];return e.forEach(function(e){if(e.value){var t=Date.parse(e.value);console.log(t),r+=t?0==r.length?e.key+e.operator+e.value:";"+e.key+e.operator+JSON.stringify(e.value).replace('"',""):0==r.length?e.key+e.operator+e.value:";"+e.key+e.operator+e.value}}),r}function n(n){r.save(n);var o=a(n.query);return console.log(o),t.lastRequestURL=n.serviceUrl+"?skip=50&take=50"+(o.length>0?"&filter="+o:""),e({method:"GET",url:n.serviceUrl,params:{skip:50,take:50,filter:o}})}return{search:n}}]),angular.module("share.ws.demo").service("TranslationService",["$q","$translate","$translatePartialLoader",function(e,r,t){return function(){return t.addPart("global"),angular.forEach(arguments,function(e){t.addPart(e)}),r.refresh()}}])}();