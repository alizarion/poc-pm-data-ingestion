/*!
 * Copyright 2015 itesoft.
 * http://itesoft.com/
 *
 * webapp_seed, v2.6.1
 * A powerful music manager.*/
!function(){angular.module("share.ws.demo",["itesoft","ngRoute","ngSanitize","mgcrea.ngStrap.datepicker","mgcrea.ngStrap.timepicker","pascalprecht.translate","ui.bootstrap.dropdown","ui.grid.pagination"]).config(["$datepickerProvider",function(e){}]).config(["$translateProvider","$translatePartialLoaderProvider","$httpProvider",function(e,r,a){e.registerAvailableLanguageKeys(["en","fr","de"],{en_US:"en",en_GB:"en",fr_FR:"fr","fr-CA":"fr","de-DE":"de"}).determinePreferredLanguage(),e.useLoader("$translatePartialLoader",{urlTemplate:"assets/locale/{lang}/{part}-{lang}.json"}),a.interceptors.push("HttpErrorHandler"),e.useSanitizeValueStrategy()}]).run(["$rootScope","$route",function(e,r){e.$on("$routeChangeSuccess",function(){e.pageTitle=r.current.title})}]),angular.module("share.ws.demo").config(["$routeProvider",function(e){e.when("/home",{templateUrl:"app/features/home/homeView.html",controller:"HomeController",title:"HOME.TITLE"}).otherwise({redirectTo:"/home"})}]),angular.module("share.ws.demo").controller("MainController",["$scope","$translate","$rootScope","CacheRequestService",function(e,r,a,t){a.searchRequest=t.load(),e.currentLanguage="fr_FR",e.changeLanguage=function(a){e.currentLanguage=a,r.use(a)}}]),angular.module("share.ws.demo").factory("CacheRequestService",["QueryField",function(e){function r(e){localStorage.setItem(t,angular.toJson(e))}function a(){var r=angular.fromJson(localStorage.getItem(t));return r||(r={},r.query=[],r.query.push(new e("SenderKey","==")),r.query.push(new e("SenderType","==")),r.query.push(new e("ActivityKey","==")),r.query.push(new e("ActivityStage","==")),r.query.push(new e("EntityKey","==")),r.query.push(new e("EntityType","==")),r.query.push(new e("ProcessKey","==")),r.query.push(new e("TaskStatus","==")),r.query.push(new e("TaskKey","==")),r.query.push(new e("SenderType","==")),r.query.push(new e("ProcessKey","==")),r.query.push(new e("CreationDate","=ge=")),r.query.push(new e("CreationDate","=le=")),r.query.push(new e("DueDate","=ge=")),r.query.push(new e("DueDate","=le="))),r.isComplete=function(){return r.serviceUrl},r}var t="share_ws_saved_request";return{load:a,save:r}}]),angular.module("share.ws.demo").factory("FetchDataService",function(){function e(e){console.log(e.header.columnsHeader);var r=0,a={};return angular.forEach(e.header.columnsHeader,function(e){a[e.code]=e.desc,r++}),a}function r(e){var r=[];return console.log(e),e.documents.forEach(function(a){var t={};t.docIdxGed=a.docIdxGed;var n=0;angular.forEach(a.fields,function(r){t[e.header.columnsHeader[n].code]=r.translation?r.translation:r.value,n++}),r.push(t)}),r}return{extractTraduction:e,extractValues:r}}),angular.module("share.ws.demo").factory("HttpErrorHandler",["$rootScope","$q",function(e,r){return{request:function(r){return e.$error=null,r},requestError:function(e){return r.reject(e)},response:function(e){return e},responseError:function(a){return a.data.status=a.status,e.$error=a.data,r.reject(a)}}}]),angular.module("share.ws.demo").factory("QueryField",[function(e){var r=function(e,r,a){this.key=e,this.operator=r,this.value=a};return r.prototype.getQueryParameter=function(){},r}]),angular.module("share.ws.demo").factory("ShareService",["$http","CacheRequestService","$rootScope",function(e,r,a){function t(e){var r=[];return e.forEach(function(e){if(e.value){var a=Date.parse(e.value);console.log(a),r+=a?0==r.length?e.key+e.operator+e.value:";"+e.key+e.operator+JSON.stringify(e.value).replace('"',""):0==r.length?e.key+e.operator+e.value:";"+e.key+e.operator+e.value}}),r}function n(n,o){r.save(n);var u=t(n.query);return console.log(u),a.lastRequestURL=n.serviceUrl+"?skip="+o+"&take=50"+(u.length>0?"&filter="+u:""),e({method:"GET",url:n.serviceUrl,params:{skip:o,take:50,filter:u}})}return{search:n}}]),angular.module("share.ws.demo").service("TranslationService",["$q","$translate","$translatePartialLoader",function(e,r,a){return function(){return a.addPart("global"),angular.forEach(arguments,function(e){a.addPart(e)}),r.refresh()}}]),angular.module("share.ws.demo").controller("HomeController",["$scope","FetchDataService","ShareService","CacheRequestService","$rootScope",function(e,r,a,t,n){e.myDefs=[],e.dataSource=[],e.myDefs=[],e.search=function(r,t){var o=0;r&&(o=100*(r-1)),a.search(n.searchRequest,o).then(function(r){e.dataSource=[],e.dataSource=r.data,e.myDefs=[];var a=e.dataSource[0];for(var t in a)e.myDefs.push({field:t});e.searchControl={columnDefs:e.myDefs},e.shareGridOptions.columnDefs=e.myDefs})},e.searchControl={columnDefs:e.myDefs},e.shareGridOptions={data:"dataSource",paginationPageSize:100,useExternalPagination:!0,showGridFooter:!0,columnDefs:e.myDefs,onRegisterApi:function(r){e.gridApi=r,e.gridApi.grid.registerRowsProcessor(e.searchControl.multicolumnsFilter,200),r.pagination.on.paginationChanged(e,function(r,a){e.search(r,a)})}},e.saveState=function(){t.save(n.searchRequest)},e.filter=function(){e.gridApi.grid.refresh()}}]),angular.module("share.ws.demo").directive("queryGrid",["QueryField",function(e){return{scope:{searchQueryFields:"="},templateUrl:"app/features/home/queryGrid.html",controller:["$scope",function(r){r.searchQueryFields||(r.searchQueryFields.query=[]),r.query={},r.addQueryField=function(){r.searchQueryFields.query.push(new e("","=="))},r.removeQueryField=function(e){var a=r.searchQueryFields.query.indexOf(e);a>-1&&r.searchQueryFields.query.splice(a,1)}}]}}])}();